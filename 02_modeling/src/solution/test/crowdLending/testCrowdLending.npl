package crowdLending

const borrower = 'Bob';
const lender = 'Alice';

@test
function verifyLoanRequestRemainingAmount(test: Test) -> {
    var loanRequest = LoanRequest[borrower, lender]("Dog hospice", 1000, 60);
    loanRequest.contribute[lender]("Alice", 500);
    loanRequest.contribute[lender]("Alice", 300);
    test.assertEquals(loanRequest.getRemainingAmount[borrower](), 200, "The remaining amount is correct");
};

@test
function verifyLoanRepaidAmount(test: Test) -> {
    var loanRequest = LoanRequest[borrower, lender]("Dog hospice", 1000, 60);
    loanRequest.contribute[lender]("Alice", 1000);
    loanRequest.loan.getOrFail().repayLoan[borrower](200);
    test.assertEquals(loanRequest.loan.getOrFail().repaidAmount, 200, "The repaid amount is correct");
};

@test
function verifyLoanObligationToRepay(test: Test) -> {
    var loanRequest = LoanRequest[borrower, lender]("Dog hospice", 1000, 60);
    loanRequest.contribute[lender]("Alice", 1000);
    loanRequest.loan.getOrFail().repayLoan[borrower](200);
    test.setTime(now().plus(days(loanRequest.loanRepaymentTimeline_Days + 1)));
    test.assertEquals(loanRequest.loan.getOrFail().activeState().getOrFail(), Loan.States.overdue, "The loan is overdue as expected");
};